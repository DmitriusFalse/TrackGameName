<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Game - TrackGameName</title>
	<link rel="stylesheet" href="/theme/{{.Theme}}/styles.css">
</head>
<body class="main-body page-game info">
	<div class="container">
		<span class="game-text" id="game">{{.CurrentGame}}</span>
	</div>
	<script>
		let lastGame = "{{.CurrentGame}}";
		let socket;
		let reconnectDelay = 5000;

		window.onload = function() {
			connectWebSocket()
		};
		function connectWebSocket() {
			socket = new WebSocket(`ws://localhost:{{.Port}}/startport`);

			socket.onopen = () => {
				console.log("✅ WebSocket подключён");

				// Пример регистрации страницы
				socket.send(JSON.stringify({ type: "register", screen: "game" }));
			};

			socket.onmessage = (event) => {
				const data = JSON.parse(event.data);
				if (data.type === "update" && data.screen === "game") {
					if (data.payload.game !== lastGame) {
						document.getElementById('game').textContent = data.payload.game;
						lastGame = data.payload.game;
					}

				}
			};

			socket.onerror = (err) => {
				console.warn("⚠️ WebSocket ошибка:", err);
			};

			socket.onclose = () => {
				console.warn("❌ WebSocket отключён. Попытка переподключения через", reconnectDelay / 1000, "сек.");
				setTimeout(connectWebSocket, reconnectDelay);
			};
		}
	</script>
</body>
</html>